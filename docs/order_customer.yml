openapi: 3.0.3
info:
  title: Order Management API - Customer
  version: 1.0.0
  description: API documentation for customer order management system
  contact:
    email: support@example.com

servers:
  - url: http://127.0.0.1:8020
    description: Local development server

security:
  - BearerAuth: []

tags:
  - name: Orders
    description: Customer order operations
  - name: Order Items
    description: Order item management

paths:
  /api/order/orders/:
    get:
      tags:
        - Orders
      summary: List all orders
      description: Retrieve a list of all orders for the authenticated customer
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/AuthorizationHeader'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Order'
              example:
                - id: "0223611c-33cf-4803-b6da-c037c5f0cb0d"
                  items:
                    - id: "5d6dd3d4-fcb2-4844-80db-9b26e294398a"
                      product: "short_intro"
                      product_variant: null
                      created_at: "2025-12-08T00:00:00Z"
                      updated_at: "2025-12-08T00:00:00Z"
                      quantity: 10
                      subtotal_amount: "0.00"
                      product_name: "TMT 500W"
                      product_price: "55666.00"
                      product_image: null
                      status: "pending"
                      order: "0223611c-33cf-4803-b6da-c037c5f0cb0d"
                  created_at: "2025-12-08T00:00:00Z"
                  updated_at: "2025-12-08T00:00:00Z"
                  total_amount: "1600.00"
                  status: "pending"
                  shipping_street_address: "123 Main Street"
                  shipping_city: "New York"
                  shipping_state: "NY"
                  shipping_postal_code: "10001"
                  shipping_country: "USA"
                  customer: "af8351f7-68be-43ad-bdc9-a563c9d1e553"
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    post:
      tags:
        - Orders
      summary: Create a new order
      description: Create a new empty order for the authenticated customer
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/AuthorizationHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                shipping_street_address:
                  type: string
                shipping_city:
                  type: string
                shipping_state:
                  type: string
                shipping_postal_code:
                  type: string
                shipping_country:
                  type: string
            example:
              shipping_street_address: "123 Main Street"
              shipping_city: "New York"
              shipping_state: "NY"
              shipping_postal_code: "10001"
              shipping_country: "USA"
      responses:
        '201':
          description: Order created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/order/orders/{id}/:
    get:
      tags:
        - Orders
      summary: Retrieve a specific order
      description: Get details of a specific order by ID
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/AuthorizationHeader'
        - name: id
          in: path
          required: true
          description: UUID of the order
          schema:
            type: string
            format: uuid
          example: "0223611c-33cf-4803-b6da-c037c5f0cb0d"
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    put:
      tags:
        - Orders
      summary: Update an order (full update)
      description: Update all fields of an order
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/AuthorizationHeader'
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderUpdate'
      responses:
        '200':
          description: Order updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '404':
          $ref: '#/components/responses/NotFoundError'

    patch:
      tags:
        - Orders
      summary: Partial update of order
      description: Update order fields including status and shipping address
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/AuthorizationHeader'
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum:
                    - pending
                    - confirmed
                    - processing
                    - shipped
                    - delivered
                    - cancelled
                shipping_street_address:
                  type: string
                shipping_city:
                  type: string
                  maxLength: 100
                shipping_state:
                  type: string
                  maxLength: 100
                shipping_postal_code:
                  type: string
                  maxLength: 20
                shipping_country:
                  type: string
                  maxLength: 100
            example:
              status: "confirmed"
              shipping_street_address: "456 Oak Avenue"
              shipping_city: "Los Angeles"
              shipping_state: "CA"
              shipping_postal_code: "90001"
              shipping_country: "USA"
      responses:
        '200':
          description: Order updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '404':
          $ref: '#/components/responses/NotFoundError'

    delete:
      tags:
        - Orders
      summary: Delete an order
      description: Delete a specific order
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/AuthorizationHeader'
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Order deleted successfully
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/order/items/:
    get:
      tags:
        - Order Items
      summary: List all order items
      description: Retrieve a list of all order items with optional filtering
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/AuthorizationHeader'
        - name: product
          in: query
          description: Filter by product ID
          schema:
            type: string
            format: uuid
        - name: status
          in: query
          description: Filter by item status
          schema:
            type: string
            enum:
              - pending
              - shipped
              - delivered
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/OrderItem'
              example:
                - id: "5d6dd3d4-fcb2-4844-80db-9b26e294398a"
                  product: "short_intro"
                  product_variant:
                    id: "ffaa9015-360f-47a8-b954-14ec48eee6a5"
                    title: "Product variant"
                    value: "abcd"
                    extra_price: "100.00"
                    sku: "ABC124"
                  created_at: "2025-12-08T00:00:00Z"
                  updated_at: "2025-12-08T00:00:00Z"
                  quantity: 10
                  subtotal_amount: "0.00"
                  product_name: "TMT 500W"
                  product_price: "55666.00"
                  product_image: null
                  status: "pending"
                  order: "0223611c-33cf-4803-b6da-c037c5f0cb0d"
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    post:
      tags:
        - Order Items
      summary: Create a new order item
      description: Add a new item to an existing order
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/AuthorizationHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderItemCreate'
            example:
              product: "short_intro"
              product_variant: "ffaa9015-360f-47a8-b954-14ec48eee6a5"
              quantity: 10
              order: "0223611c-33cf-4803-b6da-c037c5f0cb0d"
      responses:
        '201':
          description: Order item created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderItem'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                type: object
                properties:
                  product:
                    type: array
                    items:
                      type: string
                  quantity:
                    type: array
                    items:
                      type: string
                  order:
                    type: array
                    items:
                      type: string
              example:
                product:
                  - "This field is required."
                quantity:
                  - "This field is required."
                order:
                  - "This field is required."
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/order/items/{id}/:
    get:
      tags:
        - Order Items
      summary: Retrieve a specific order item
      description: Get details of a specific order item by ID
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/AuthorizationHeader'
        - name: id
          in: path
          required: true
          description: UUID of the order item
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderItem'
        '404':
          $ref: '#/components/responses/NotFoundError'

    put:
      tags:
        - Order Items
      summary: Update an order item (full update)
      description: Update all fields of an order item
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/AuthorizationHeader'
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderItemCreate'
            example:
              product: "asus-laptop"
              product_variant: "ffaa9015-360f-47a8-b954-14ec48eee6a5"
              quantity: 5
              order: "0223611c-33cf-4803-b6da-c037c5f0cb0d"
      responses:
        '200':
          description: Order item updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderItem'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '404':
          $ref: '#/components/responses/NotFoundError'

    patch:
      tags:
        - Order Items
      summary: Partial update of order item
      description: Update quantity or product variant of an order item
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/AuthorizationHeader'
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                quantity:
                  type: integer
                  minimum: 1
                product_variant:
                  type: string
                  format: uuid
                  nullable: true
            example:
              quantity: 15
              product_variant: "ffaa9015-360f-47a8-b954-14ec48eee6a5"
      responses:
        '200':
          description: Order item updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderItem'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '404':
          $ref: '#/components/responses/NotFoundError'

    delete:
      tags:
        - Order Items
      summary: Delete an order item
      description: Remove an item from an order
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/AuthorizationHeader'
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Order item deleted successfully
        '404':
          $ref: '#/components/responses/NotFoundError'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token authentication

  parameters:
    AuthorizationHeader:
      name: Authorization
      in: header
      required: true
      description: JWT Bearer token for authentication
      schema:
        type: string
        example: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"

  schemas:
    Order:
      type: object
      properties:
        id:
          type: string
          format: uuid
          readOnly: true
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'
          readOnly: true
        created_at:
          type: string
          format: date-time
          readOnly: true
        updated_at:
          type: string
          format: date-time
          readOnly: true
        total_amount:
          type: string 
          readOnly: true
          description: Calculated total of all order items
        status:
          type: string
          enum:
            - pending
            - confirmed
            - processing
            - shipped
            - delivered
            - cancelled
          default: pending
        shipping_street_address:
          type: string
          nullable: true
          description: Street address for order delivery
        shipping_city:
          type: string
          maxLength: 100
          nullable: true
          description: City for order delivery
        shipping_state:
          type: string
          maxLength: 100
          nullable: true
          description: State/Province for order delivery
        shipping_postal_code:
          type: string
          maxLength: 20
          nullable: true
          description: Postal/ZIP code for order delivery
        shipping_country:
          type: string
          maxLength: 100
          nullable: true
          default: Bangladesh
          description: Country for order delivery

    OrderUpdate:
      type: object
      required:
        - status 
      properties:
        status:
          type: string
          enum:
            - pending
            - confirmed
            - processing
            - shipped
            - delivered
            - cancelled
        shipping_street_address:
          type: string
          nullable: true
        shipping_city:
          type: string
          maxLength: 100
          nullable: true
        shipping_state:
          type: string
          maxLength: 100
          nullable: true
        shipping_postal_code:
          type: string
          maxLength: 20
          nullable: true
        shipping_country:
          type: string
          maxLength: 100
          nullable: true

    ProductVariant:
      type: object
      properties:
        id:
          type: string
          format: uuid
          readOnly: true
        title:
          type: string
          description: Variant title/name
        value:
          type: string
          description: Variant value
        extra_price:
          type: string 
          description: Additional price for this variant
        sku:
          type: string
          description: Stock Keeping Unit identifier

    OrderItem:
      type: object
      properties:
        id:
          type: string
          format: slug
          readOnly: true
        product:
          type: string
          description: Product identifier (slug)
          example: asus-laptop
        product_variant:
          allOf:
            - $ref: '#/components/schemas/ProductVariant'
          nullable: true
          readOnly: true
          description: Product variant details (if applicable)
        created_at:
          type: string
          format: date-time
          readOnly: true
        updated_at:
          type: string
          format: date-time
          readOnly: true
        quantity:
          type: integer
          minimum: 1
        subtotal_amount:
          type: string 
          readOnly: true
          description: Calculated as (product_price + variant_extra_price) * quantity
        product_name:
          type: string
          maxLength: 200
          readOnly: true
          description: Snapshot of product name at order time
        product_price:
          type: string 
          readOnly: true
          description: Snapshot of product price at order time
        product_image:
          type: string
          format: uri
          nullable: true
          readOnly: true
          description: Snapshot of product image URL
        status:
          type: string
          enum:
            - pending
            - shipped
            - delivered
          default: pending
          readOnly: true
        order:
          type: string
          format: uuid
          description: UUID of the parent order

    OrderItemCreate:
      type: object
      required:
        - product
        - quantity
        - order
      properties:
        product:
          type: string
          description: Product identifier (slug)
          example: asus-laptop
        product_variant:
          type: string
          format: uuid
          nullable: true
          description: UUID of the product variant (optional)
        quantity:
          type: integer
          minimum: 1
        order:
          type: string
          format: uuid
          description: UUID of the parent order

  responses:
    UnauthorizedError:
      description: Authentication credentials were not provided or are invalid
      content:
        application/json:
          schema:
            type: object
            properties:
              detail:
                type: string
          example:
            detail: "Authentication credentials were not provided."

    BadRequestError:
      description: Invalid request data
      content:
        application/json:
          schema:
            type: object
            additionalProperties:
              type: array
              items:
                type: string

    NotFoundError:
      description: Resource not found
      content:
        application/json:
          schema:
            type: object
            properties:
              detail:
                type: string
          example:
            detail: "Not found."